# Code for _Self-Directed Online Learning for Topology Optimization_
This repository contains code of the following paper:

Changyu Deng, Can Qin, and Wei Lu. "Self-Directed Online Learning for Topology Optimization." arXiv preprint arXiv:2002.01927 (2020) [Download](https://arxiv.org/pdf/2002.01927.pdf) 

## Contact
Changyu Deng (dengcy@umich.edu), Can Qin (qin.ca@husky.neu.edu), Wei Lu (weilu@umich.edu)

## Software environment
* COMSOL Multiphysics 5.4
* Matlab 2019b
* Python 3.7
  * SciPy 1.2.0
  * PyTorch 1.2.0

## Introduction
There are two examples in the paper, one with coarse mesh and the other with fine mesh. Their code is in their individual folders; they do not share files. The names of the files in two folders are the same; the functions are the same as well.

### Code
* <strong>force.m</strong>: MATLAB script to generate a _COMSOL_ file, used to calculate elastic energy based on given density distribution
* <strong>force_optimized.m</strong>: MATLAB script to generate a _COMSOL_ file, used to calculate optimal configuration based on MMA

* <strong>func_*.m</strong>: MATLAB function scripts
	* <strong>func_inputs_gen.m</strong>: a function to generate
  
* <strong>main_*.m</strong>: MATLAB code to generate data (stored in the subfolders)
	* <strong>main_nl.m</strong>: code to generate data in subfolder "data_nl"
	* <strong>main_wl.m</strong>: code to generate data in subfolder "data_wl"

* <strong>plot_*.m</strong>: MATLAB code to plot the data
	* <strong>plot_b_c.m</strong>: plot figures b and c
	* <strong>plot_d_e_f.m</strong>: plot figures d, e, and f
  
* <strong>mlopt.py</strong>: (abbreviation of Machine Learning and OPTimization) python code to train a Deep Learning Network (DNN) and obtain the optimized solution based on the DNN by Generative Simulated Annealing (GSA).

### Data
If you run the code, data will be generated and stored in subfolders:
* <strong>data_nl</strong>: data generated by the code for the algorithm with offline learning (no loop)
* <strong>data_wl</strong>: data generated by the code for the algorithm with online learning (with loop)   


Data are not uploaded on Github. Please download from [Google Drive](https://drive.google.com/drive/folders/1f6Xrd9e-RAUsh9vqIqUXbEw8F1_2Qg_5?usp=sharing) or email us.

## How to run

1. Run __force.m__ by COMSOL to generate __force.mph__
2. Run __main_nl.m__ or __main_wl.m__. Remember to connect MATLAB with COMSOL server
3. Run __plot_b_c.m__
4. Run __force_optimized.m__ by COMSOL to generate __force_optimized.mph__
5. Run __plot_d_e_f.m__

## Reproducibility
Please note that the reproducibility is not guranteed due to PyTorch platform (see its [documentation](https://pytorch.org/docs/stable/notes/randomness.html#reproducibility)).

## License
[MIT](https://choosealicense.com/licenses/mit/)